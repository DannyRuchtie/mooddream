(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{3321:(e,t,s)=>{"use strict";var a=s(4645);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},6943:(e,t,s)=>{Promise.resolve().then(s.bind(s,9689))},9689:(e,t,s)=>{"use strict";s.d(t,{default:()=>r});var a=s(5155),i=s(2115),n=s(3321);function r(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)(),s=t?.get("projectId")??null,[r,c]=(0,i.useState)(!1),[d,o]=(0,i.useState)(!1),[l,m]=(0,i.useState)(!1),[x,u]=(0,i.useState)(null),[h,p]=(0,i.useState)({storage:{mode:"local"},ai:{provider:"local_station"}}),[g,b]=(0,i.useState)({icloudDir:null,moondreamEndpoint:"http://127.0.0.1:2020"}),v=(0,i.useMemo)(()=>"icloud"!==h.storage.mode?null:h.storage.icloudPath||g.icloudDir,[h.storage.mode,h.storage.icloudPath,g.icloudDir]);return(0,i.useEffect)(()=>{let e=!1;return(async()=>{let t=await fetch("/api/settings");if(!t.ok)return;let s=await t.json();e||(p(s.settings),b(s.defaults),c(!0))})().catch(()=>c(!0)),()=>{e=!0}},[]),(0,a.jsx)("div",{className:"min-h-screen bg-zinc-950 text-zinc-50",children:(0,a.jsxs)("div",{className:"mx-auto max-w-3xl px-6 py-10",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold",children:"Settings"}),(0,a.jsx)("div",{className:"mt-1 text-sm text-zinc-500",children:"Desktop settings apply after restart."})]}),(0,a.jsx)("button",{onClick:()=>{let t=s?`/projects/${s}`:"/";e.push(t)},className:"rounded-md border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-300 hover:bg-zinc-900",children:"Back"})]}),(0,a.jsxs)("div",{className:"mt-8 rounded-xl border border-zinc-800 bg-zinc-950 p-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"Storage"}),(0,a.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:"Default is local. Switching storage will move your library (DB + assets) on next app launch. iCloud sync is convenient but SQLite can misbehave if you open the app on two Macs at the same time."}),(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-start gap-3 rounded-lg border border-zinc-900 bg-zinc-950 px-3 py-3",children:[(0,a.jsx)("input",{type:"radio",name:"storage",checked:"local"===h.storage.mode,onChange:()=>p(e=>({...e,storage:{...e.storage,mode:"local"}})),className:"mt-1"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-zinc-200",children:"Local (recommended)"}),(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:"Stores data in Application Support on this Mac."})]})]}),(0,a.jsxs)("label",{className:"flex items-start gap-3 rounded-lg border border-zinc-900 bg-zinc-950 px-3 py-3",children:[(0,a.jsx)("input",{type:"radio",name:"storage",checked:"icloud"===h.storage.mode,onChange:()=>{p(e=>({...e,storage:{...e.storage,mode:"icloud",icloudPath:(e.storage.icloudPath??g.icloudDir??void 0)||void 0}}))},className:"mt-1"}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"text-sm text-zinc-200",children:"iCloud Drive"}),(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:"Stores data in iCloud Drive for syncing between Macs (avoid running on two Macs concurrently)."}),(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("div",{className:"text-xs text-zinc-500 mb-1",children:"iCloud path"}),(0,a.jsx)("input",{disabled:"icloud"!==h.storage.mode,value:h.storage.icloudPath??"",onChange:e=>p(t=>({...t,storage:{...t.storage,icloudPath:e.target.value}})),placeholder:g.icloudDir??"iCloud Drive path",className:"w-full rounded-lg border border-zinc-800 bg-zinc-900 px-3 py-2 text-xs text-zinc-200 outline-none disabled:opacity-60"}),(0,a.jsxs)("div",{className:"mt-2 text-[11px] text-zinc-600",children:["Leave blank to use the default: ",(0,a.jsx)("span",{className:"text-zinc-400",children:g.icloudDir??"N/A"})]})]})]})]})]}),x?(0,a.jsx)("div",{className:"mt-4 text-sm text-red-400",children:x}):null,l?(0,a.jsx)("div",{className:"mt-4 rounded-lg border border-amber-900/40 bg-amber-950/20 px-3 py-2 text-sm text-amber-200",children:"Saved. Close and reopen the app to apply storage changes (and move your library if you changed storage)."}):null,(0,a.jsxs)("div",{className:"mt-4 flex items-center gap-3",children:[(0,a.jsx)("button",{disabled:!r||d,onClick:async()=>{o(!0),m(!1),u(null);try{let e={storage:{mode:h.storage.mode,icloudPath:"icloud"===h.storage.mode&&h.storage.icloudPath?.trim()||void 0},ai:{provider:h.ai.provider,endpoint:h.ai.endpoint?.trim()||void 0}};if(!(await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Failed to save settings");m(!0)}catch(e){u(e.message)}finally{o(!1)}},className:"rounded-lg bg-zinc-50 px-4 py-2 text-sm font-medium text-zinc-950 disabled:opacity-60",children:d?"Saving…":"Save"}),"icloud"===h.storage.mode&&v?(0,a.jsxs)("div",{className:"text-xs text-zinc-500",children:["Effective path: ",(0,a.jsx)("span",{className:"text-zinc-300",children:v})]}):null]})]}),(0,a.jsxs)("div",{className:"mt-8 rounded-xl border border-zinc-800 bg-zinc-950 p-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"AI"}),(0,a.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:"Configure the Moondream endpoint used by the bundled worker. If you see “failed”, it often means the app couldn’t reach the endpoint at the time."}),(0,a.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-1 text-xs text-zinc-500",children:"Moondream endpoint"}),(0,a.jsx)("input",{value:h.ai.endpoint??"",onChange:e=>p(t=>({...t,ai:{...t.ai,endpoint:e.target.value}})),placeholder:g.moondreamEndpoint,className:"w-full rounded-lg border border-zinc-800 bg-zinc-900 px-3 py-2 text-xs text-zinc-200 outline-none"}),(0,a.jsxs)("div",{className:"mt-2 text-[11px] text-zinc-600",children:["Examples: ",(0,a.jsx)("span",{className:"text-zinc-400",children:"http://127.0.0.1:2021/v1"})," or"," ",(0,a.jsx)("span",{className:"text-zinc-400",children:"http://127.0.0.1:2020"})," (the worker accepts both and normalizes). If ",(0,a.jsx)("span",{className:"text-zinc-400",children:"localhost"})," gives issues, prefer"," ",(0,a.jsx)("span",{className:"text-zinc-400",children:"127.0.0.1"}),"."]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{disabled:!s,onClick:async()=>{if(s){u(null);try{if(!(await fetch(`/api/projects/${s}/ai/retry`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})})).ok)throw Error("Retry failed")}catch(e){u(e.message)}}},className:"rounded-md border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-300 hover:bg-zinc-900 disabled:opacity-50",children:"Retry failed AI (this project)"}),s?null:(0,a.jsx)("div",{className:"text-xs text-zinc-600",children:"Open Settings from inside a project to enable this."})]})]})]})]})})}}},e=>{e.O(0,[441,794,358],()=>e(e.s=6943)),_N_E=e.O()}]);