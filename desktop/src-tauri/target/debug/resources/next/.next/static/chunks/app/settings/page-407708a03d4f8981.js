(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{2374:(e,t,s)=>{"use strict";s.d(t,{J0:()=>i,TE:()=>o,aJ:()=>a,w9:()=>n,yl:()=>r});let a=220,i="moondream:route-fade:start",n="moondream:route-fade:end";function r(){window.dispatchEvent(new Event(i))}function o(){window.dispatchEvent(new Event(n))}},3321:(e,t,s)=>{"use strict";var a=s(4645);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},6943:(e,t,s)=>{Promise.resolve().then(s.bind(s,9689))},9689:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var a=s(5155),i=s(2115),n=s(3321),r=s(2374);function o(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)(),s=t?.get("projectId")??null,[o,c]=(0,i.useState)("enter"),d=(0,i.useRef)(null),l=(0,i.useRef)(!1),u=(0,i.useRef)(s),[m,x]=(0,i.useState)(!1),[p,h]=(0,i.useState)(!1),[g,v]=(0,i.useState)(!1),[f,b]=(0,i.useState)(null),[y,j]=(0,i.useState)(null),[N,z]=(0,i.useState)(!1),[w,S]=(0,i.useState)({storage:{mode:"local"},ai:{provider:"local_station"}}),[E,k]=(0,i.useState)({icloudDir:null,moondreamEndpoint:"http://127.0.0.1:2020"}),C=(0,i.useMemo)(()=>"icloud"!==w.storage.mode?null:w.storage.icloudPath||E.icloudDir,[w.storage.mode,w.storage.icloudPath,E.icloudDir]);(0,i.useEffect)(()=>{let e=!1;return(async()=>{let t=await fetch("/api/settings");if(!t.ok)return;let s=await t.json();e||(S(s.settings),k(s.defaults),x(!0))})().catch(()=>x(!0)),()=>{e=!0}},[]),(0,i.useEffect)(()=>{u.current=s},[s]),(0,i.useEffect)(()=>{(0,r.TE)()},[]),(0,i.useEffect)(()=>{let e=window.requestAnimationFrame(()=>c("entered"));return()=>window.cancelAnimationFrame(e)},[]);let P=()=>{l.current||(l.current=!0,(0,r.yl)(),c("exit"),d.current&&window.clearTimeout(d.current),d.current=window.setTimeout(()=>{let t,s;d.current=null,s=(t=u.current)?`/projects/${t}`:"/",e.push(s)},r.aJ))};(0,i.useEffect)(()=>()=>{d.current&&window.clearTimeout(d.current),d.current=null},[]),(0,i.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(e.preventDefault(),P())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);let D=async()=>{h(!0),v(!1),b(null);try{let e={storage:{mode:w.storage.mode,icloudPath:"icloud"===w.storage.mode&&w.storage.icloudPath?.trim()||void 0},ai:{provider:w.ai.provider,endpoint:w.ai.endpoint?.trim()||void 0}};if(!(await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Failed to save settings");v(!0)}catch(e){b(e.message)}finally{h(!1)}};return(0,a.jsxs)("div",{className:"fixed inset-0 overflow-auto text-zinc-50",children:[(0,a.jsx)("div",{className:`pointer-events-none fixed inset-0 bg-black transition-opacity duration-200 ease-out motion-reduce:transition-none ${"entered"===o||"exit"===o?"opacity-100":"opacity-0"}`}),(0,a.jsxs)("div",{className:`relative mx-auto max-w-3xl px-6 py-10 transition-[opacity,transform] duration-200 ease-out motion-reduce:transition-none ${"entered"===o?"opacity-100 translate-y-0":"opacity-0 translate-y-1"}`,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold",children:"Settings"}),(0,a.jsx)("div",{className:"mt-1 text-sm text-zinc-500",children:"Desktop settings apply after restart."})]}),(0,a.jsx)("button",{onClick:()=>{P()},className:"rounded-md border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-300 hover:bg-zinc-900",children:"Back"})]}),(0,a.jsxs)("div",{className:"mt-8 rounded-xl border border-zinc-800 bg-zinc-950 p-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"Storage"}),(0,a.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:"Default is local. Switching storage will move your library (DB + assets) on next app launch. iCloud sync is convenient but SQLite can misbehave if you open the app on two Macs at the same time."}),(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-start gap-3 rounded-lg border border-zinc-900 bg-zinc-950 px-3 py-3",children:[(0,a.jsx)("input",{type:"radio",name:"storage",checked:"local"===w.storage.mode,onChange:()=>S(e=>({...e,storage:{...e.storage,mode:"local"}})),className:"mt-1"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-zinc-200",children:"Local (recommended)"}),(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:"Stores data in Application Support on this Mac."})]})]}),(0,a.jsxs)("label",{className:"flex items-start gap-3 rounded-lg border border-zinc-900 bg-zinc-950 px-3 py-3",children:[(0,a.jsx)("input",{type:"radio",name:"storage",checked:"icloud"===w.storage.mode,onChange:()=>{S(e=>({...e,storage:{...e.storage,mode:"icloud",icloudPath:(e.storage.icloudPath??E.icloudDir??void 0)||void 0}}))},className:"mt-1"}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"text-sm text-zinc-200",children:"iCloud Drive"}),(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:"Stores data in iCloud Drive for syncing between Macs (avoid running on two Macs concurrently)."}),(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("div",{className:"text-xs text-zinc-500 mb-1",children:"iCloud path"}),(0,a.jsx)("input",{disabled:"icloud"!==w.storage.mode,value:w.storage.icloudPath??"",onChange:e=>S(t=>({...t,storage:{...t.storage,icloudPath:e.target.value}})),placeholder:E.icloudDir??"iCloud Drive path",className:"w-full rounded-lg border border-zinc-800 bg-zinc-900 px-3 py-2 text-xs text-zinc-200 outline-none disabled:opacity-60"}),(0,a.jsxs)("div",{className:"mt-2 text-[11px] text-zinc-600",children:["Leave blank to use the default: ",(0,a.jsx)("span",{className:"text-zinc-400",children:E.icloudDir??"N/A"})]})]})]})]})]}),f?(0,a.jsx)("div",{className:"mt-4 text-sm text-red-400",children:f}):null,g?(0,a.jsx)("div",{className:"mt-4 rounded-lg border border-amber-900/40 bg-amber-950/20 px-3 py-2 text-sm text-amber-200",children:"Saved. Close and reopen the app to apply storage changes (and move your library if you changed storage)."}):null,(0,a.jsxs)("div",{className:"mt-4 flex items-center gap-3",children:[(0,a.jsx)("button",{disabled:!m||p,onClick:D,className:"rounded-lg bg-zinc-50 px-4 py-2 text-sm font-medium text-zinc-950 disabled:opacity-60",children:p?"Saving…":"Save"}),"icloud"===w.storage.mode&&C?(0,a.jsxs)("div",{className:"text-xs text-zinc-500",children:["Effective path: ",(0,a.jsx)("span",{className:"text-zinc-300",children:C})]}):null]})]}),(0,a.jsxs)("div",{className:"mt-8 rounded-xl border border-zinc-800 bg-zinc-950 p-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"AI"}),(0,a.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:"Configure the Moondream endpoint used by the bundled worker. If you see “failed”, it often means the app couldn’t reach the endpoint at the time."}),(0,a.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-1 text-xs text-zinc-500",children:"Moondream endpoint"}),(0,a.jsx)("input",{value:w.ai.endpoint??"",onChange:e=>S(t=>({...t,ai:{...t.ai,endpoint:e.target.value}})),placeholder:E.moondreamEndpoint,className:"w-full rounded-lg border border-zinc-800 bg-zinc-900 px-3 py-2 text-xs text-zinc-200 outline-none"}),(0,a.jsxs)("div",{className:"mt-2 text-[11px] text-zinc-600",children:["Examples: ",(0,a.jsx)("span",{className:"text-zinc-400",children:"http://127.0.0.1:2021/v1"})," or"," ",(0,a.jsx)("span",{className:"text-zinc-400",children:"http://127.0.0.1:2020"})," (the worker accepts both and normalizes). If ",(0,a.jsx)("span",{className:"text-zinc-400",children:"localhost"})," gives issues, prefer"," ",(0,a.jsx)("span",{className:"text-zinc-400",children:"127.0.0.1"}),"."]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{disabled:!m||p,onClick:D,className:"rounded-md border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-300 hover:bg-zinc-900 disabled:opacity-50",children:p?"Saving…":"Save endpoint"}),(0,a.jsx)("button",{disabled:!s,onClick:async()=>{if(s){b(null),j(null),z(!0);try{let e=await fetch(`/api/projects/${s}/ai/retry`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!e.ok)throw Error("Retry failed");let t=await e.json().catch(()=>null),a=t?.changes??0;j(a>0?`Retried ${a} asset(s).`:"No failed assets to retry.")}catch(e){b(e.message)}finally{z(!1)}}},className:"rounded-md border border-zinc-800 bg-zinc-950 px-3 py-2 text-sm text-zinc-300 hover:bg-zinc-900 disabled:opacity-50",children:N?"Retrying…":"Retry failed AI (this project)"}),s?null:(0,a.jsx)("div",{className:"text-xs text-zinc-600",children:"Open Settings from inside a project to enable this."})]}),y?(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:y}):null]})]})]})]})}}},e=>{e.O(0,[441,794,358],()=>e(e.s=6943)),_N_E=e.O()}]);